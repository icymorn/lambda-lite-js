/*! PROJECT_NAME - v0.1.0 - 2015-10-29
* http://icymorn.github.io/lambda-lite-js/
* Copyright (c) 2015 ICYMORN; Licensed MIT */
var ll={exports:{},require:function(a){return ll.exports[a]}},define=function(){function a(b,e,f){if(void 0!==c[b]&&c[b].load===!0)return!0;for(var g=!0,h=0,i=e.length;i>h;h++)void 0===c[e[h]]?g=!1:c[e[h]].load===!1&&(a(e[h],c[e[h]].depends,c[e[h]].func)||(g=!1));if(g){var j;ll.exports[b]={},f(ll.exports[b]),c[b].load=!0,delete d[b];for(j in d)a(j,c[j].depends,c[j].func);return!0}return d[b]=!0,!1}function b(){return e++}var c={},d={},e=0;return function(){if(1===arguments.length)arguments[0](morn);else if(2===arguments.length){var d;"string"==typeof arguments[0]?(d=arguments[0],c[d]={load:!1,depends:[],func:arguments[1]},a(d,[],arguments[1])):(d=b(),c[d]={load:!1,depends:arguments[0],func:arguments[1]},a(d,arguments[0],arguments[1]))}else if(3===arguments.length){var d=arguments[0];c[d]={load:!1,depends:arguments[1],func:arguments[2]},a(d,arguments[1],arguments[2])}}}();if("undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./lex",["./util","./token","./node","./pattern"],function(a){function b(a){var b=L[a];return void 0===b?-1:b}function c(){for(var a=F++;E>F&&G.isWhite(D.charAt(F));)F++;return D.slice(a,F)}function d(){for(var a=F++;E>F;){if("\n"===D.charAt(F)){F++;break}F++}return D.slice(a,F)}function e(){for(var a=F++;E>F;){if("*"===D.charAt(F)&&(F++,E>F&&"/"===D.charAt(F))){F++;break}F++}return D.slice(a,F)}function f(){for(var a=F,b=D.charAt(F++),c=b;E>F&&(b=D.charAt(F++),b!==c););if(b!==c)throw"no matching for: "+c;return D.slice(a+1,F-1)}function g(){for(var a,b=F++;E>F&&(a=D.charAt(F),G.isIdentifierBody(a));)F++;return D.slice(b,F)}function h(){for(var a,b=F++,c=!1;E>F;)if(a=D.charAt(F),G.isDigit(a))F++;else{if(c!==!1||"."!==a)break;c=!0,F++}return D.slice(b,F)}function i(){var a,b=D.charAt(F),c=F++;return G.isSinglePunctuator(b)?b:("+"===b?E>F&&(a=D.charAt(F),("+"===a||"="===a)&&F++):"-"===b?E>F&&(a=D.charAt(F),("-"===a||">"===a||"="===a)&&F++):"*"===b?E>F&&(a=D.charAt(F),"="===a&&F++):"/"===b?E>F&&(a=D.charAt(F),("="===a||"*"===a||"/"===a)&&F++):"="===b?E>F&&(a=D.charAt(F),"="===a&&(F++,E>F&&(a=D.charAt(F),"="===a&&F++))):">"===b?E>F&&(a=D.charAt(F),"="===a?F++:">"===a&&(F++,E>F&&(a=D.charAt(F),"="===a&&F++))):"<"===b?E>F&&(a=D.charAt(F),"="===a?F++:"<"===a&&(F++,E>F&&(a=D.charAt(F),"="===a&&F++))):"!"===b?E>F&&(a=D.charAt(F),"="===a?(F++,E>F&&(a=D.charAt(F),"="===a&&F++)):"!"===a&&F++):"&"===b?E>F&&(a=D.charAt(F),"&"===a&&F++):"|"===b&&E>F&&(a=D.charAt(F),"|"===a&&F++),D.slice(c,F))}function j(){var a;for(M=N;E>F;){var b=D.charAt(F);if(G.isWhite(b))a=new H(K.White,c());else if(G.isDigit(b))a=new H(K.Numberic,h());else if(G.isIdentifierStart(b)){var j=g();a=G.isKeyword(j)?new H(K.Keyword,j):G.isBooleanLiteral(j)?new H(K.BooleanLiteral,j):G.isNullLiteral(j)?new H(K.NullLiteral,j):new H(K.Identifier,j)}else if(G.isPunctuator(b)){var j=i();a="//"===j?new H(K.CommentLiteral,j+d()):"/*"===j?new H(K.CommentLiteral,j+e()):new H(K.Punctuator,j)}else G.isLiteralStart(b)&&(a=new H(K.Literal,f()));if(a.type!==K.EOF&&a.type!==K.White)return N=a,a}return null!==M&&M.type!==K.EOF&&(M=N),N=new H(K.EOF,null)}function k(a){return N.value===a}function l(a){if(M.value!==a||M.type!==K.Punctuator)throw"expect for: "+a;j()}function m(a){if(M.value!==a||M.type!==K.Keyword)throw"expect for: "+a;j()}function n(a){if(N.value!==a||N.type!==K.Punctuator)throw"expect for:"+a;j(),j()}function o(){j();var a=B();if(null===a)return null;if(")"!==M.value)throw"expect for : )";return j(),a}function p(){var a=C();return null===a?null:s(0,a)}function q(){j();for(var a=[];M.type!==K.EOF;){if((M.type===K.Numberic||M.type===K.Literal||M.type===K.BooleanLiteral)&&a.push(M.value),k("]")){n("]");break}n(",")}return new I.listNode(a)}function r(){for(var a=p();;)if(M.type===K.Numberic||M.type===K.Identifier||M.type===K.Literal||M.type===K.BooleanLiteral)a=new I.callNode(a,p());else{if(M.type!==K.Punctuator)return a;if("("===M.value)a=new I.callNode(a,o());else if("$"===M.value)j(),a=new I.callNode(a,r());else if("."===M.value){j();var b=a,c=r();a=new I.lambdaNode("$1",new I.callNode(b,new I.callNode(c,new I.objectNode("$1"))))}else{if(","!==M.value)return a;j(),a=new I.consNode(a,p())}}}function s(a,c){if(M.type===K.Punctuator&";"===M.value)return c;for(;;){var d=b(M.value);if(a>d)return c;var e=M.value;j();var f=C();if(null===f)return null;var g=b(M.value);if(g>d&&(f=s(d+1,f),null===f))return null;var h=new I.expressionNode(e);h.left=c,h.right=f,c=h}}function t(){var a=new I.numberNode(Number(M.value));return j(),a}function u(){var a=new I.booleanNode("true"===M.value);return j(),a}function v(){var a=new I.literalNode(M.value);return j(),a}function w(){j();var a=M.value;n("->");var b=B();return new I.lambdaNode(a,b)}function x(){var a=new I.objectNode(M.value);return j(),a}function y(){j();var a=B();m("then");var b=B();m("else");var c=B();return new I.ifConditionNode(a,b,c)}function z(){j();var a,b,c=M.value;if(k("="))n("="),b=B();else if(j(),k("@"))b=A();else{for(var d=[];!k("=");)b=x(),d.push(b);for(b=x(),d.push(b),l("="),b=B();d.length>0;)b=new I.lambdaNode(d.pop().id,b)}var e=b;if(k("->")){j();var f=B();a=new I.defineNode(c,e,f)}else j(),a=new I.defineNode(c,e,null);return a}function A(){for(var a=[],b=[];M.type!==K.Punctuator&&"="!==M.value;){var c,d=x().id;l("@"),M.type===K.Keyword?"Boolean"===M.value?c=new J.unit(Boolean):"Number"===M.value?c=new J.unit(Number):"String"===M.value&&(c=new J.unit(String)):M.type===K.Numberic?c=new J.unit(Number(M.value)):M.type===K.BooleanLiteral?c=new J.unit("true"===M.value):M.type===K.Literal?c=new J.unit(M.value):M.type===K.Punctuator&&"*"===M.value&&(c=new J.any),a.push(d),b.push(c),j()}l("=");var e=B();for(e=new I.patternNode(a.concat(),b,e);a.length>0;)e=new I.lambdaNode(a.pop(),e);return e}function B(){return M.type===K.Punctuator&&"\\"===M.value?w():M.type===K.Keyword&&"let"===M.value?z():M.type===K.Punctuator&&";"===M.value?null:M.type===K.EOF?null:r()}function C(){return null===M?null:M.type===K.Identifier?x():M.type===K.Numberic?t():M.type===K.Literal?v():M.type===K.BooleanLiteral?u():M.type!==K.Punctuator?M.type===K.Keyword&&"if"===M.value?y():null:"("===M.value?o():'"'===M.value||"'"===M.value?v():"["===M.value?q():void 0}var D,E,F,G=require("./util").Util,H=require("./token").Token,I=require("./node").Node,J=require("./pattern").Pattern,K={EOF:1,Identifier:2,Keyword:3,Numberic:4,Punctuator:5,Literal:6,NullLiteral:7,BooleanLiteral:8,CommentLiteral:9,List:10,White:11,Unknown:12},L={"||":10,"&&":20,"|":30,"^":40,"&":50,"==":60,"!=":60,"===":60,"!==":60,"<":70,">":70,"<=":70,">=":70,"<<":80,">>":80,"+":90,"-":90,"*":110,"/":110,"%":110,"++":110,"!!":110,":":110},M=null,N=null;a.parse=function(a){D=a,E=D.length,F=0,N=null},a.genTree=function(){var a=[];if(j(),j(),!M)return a;for(var b=0,c=1e3;M.type!==K.EOF&&b++<c;){for(var d=B();M.type===K.Punctuator&&";"===M.value;)j();if(!d)break;a.push(d)}return a}}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./node",[],function(a){function b(a){this.func=a}function c(a,b){this.callee=a,this.arg=b}function d(a){this.id=a}function e(a){this.value=a}function f(a){this.operator=a,this.left=null,this.right=null}function g(a,b){this.id=a,this.expre=b}function h(a){this.bool=a}function i(a){this.literal=a}function j(a,b,c){this.id=a,this.expre=b,this.body=c}function k(a,b,c){this.cond=a,this.expre1=b,this.expre2=c}function l(a){return a.constructor===Number?new e(a):a.constructor===String?new i(a):a.constructor===Boolean?new h(a):new e(a)}function m(a,b){this.expre1=a,this.expre2=b}function n(a){this.ele=a}function o(a,b,c){this.ids=a,this.patterns=b,this.next=null,this.expre=c}var p={Function:1,Object:2,Expression:3};b.prototype.getValue=function(a){return this.func(a)},c.prototype.getValue=function(a){var b=this.arg.getValue(a),c=this.callee.getValue(a);return c(l(b))},d.prototype.getValue=function(a){var b=a.lookup(this.id);if(void 0===b)throw"Cannot to find: "+this.id;return b.getValue(a)},e.prototype.getValue=function(a){return this.value},f.prototype.getValue=function(a){var b,c=this.left.getValue(a);if("*"===this.operator)return b=this.right.getValue(a),c*b;if("/"===this.operator){if(b=this.right.getValue(a),0===b)throw"divided by zero";return c/b}if("+"===this.operator)return b=this.right.getValue(a),c+b;if("-"===this.operator)return b=this.right.getValue(a),c-b;if("=="===this.operator)return b=this.right.getValue(a),c===b;if("!="===this.operator)return b=this.right.getValue(a),c!==b;if(">"===this.operator)return b=this.right.getValue(a),c>b;if("<"===this.operator)return b=this.right.getValue(a),b>c;if(">="===this.operator)return b=this.right.getValue(a),c>=b;if("<="===this.operator)return b=this.right.getValue(a),b>=c;if("||"===this.operator)return c===!0?!0:this.right.getValue(a);if("&&"===this.operator)return c===!1?!1:this.right.getValue(a);if("++"===this.operator){b=this.right.getValue(a);var d=c.concat(b);return d}return":"===this.operator?(b=this.right.getValue(a),c.constructor===Array?c.concat(b):[].concat(c,b)):"!!"===this.operator?(b=this.right.getValue(a),c[b]):void 0},g.prototype.getValue=function(a){var b=new a.constructor(a),c=this.id,d=this.expre;return function(a){return b.add(c,a),d.getValue(b)}},h.prototype.getValue=function(a){return this.bool},i.prototype.getValue=function(a){return this.literal},j.prototype.getValue=function(a){if(void 0===a.table[this.id])a.add(this.id,this.expre);else{for(var b=a.table[this.id];b.constructor===g;)b=b.expre;if(b.constructor===o)if(void 0===a.table[this.id])a.add(this.id,this.expre);else{for(;null!==b.next;)b=b.next;b.next=this.expre.expre}}return null!==this.body?this.body.getValue(a):null},k.prototype.getValue=function(a){return this.cond.getValue(a)===!1?this.expre2.getValue(a):this.expre1.getValue(a)},m.prototype.getValue=function(a){return null===this.expre2?this.expre1.getValue(a):(this.expre1.getValue(a),this.expre2.getValue(a))},n.prototype.getValue=function(a){return this.ele},o.prototype.getValue=function(a){var b=this.ids,c=this.patterns.every(function(c,d){return c.expect(a.lookup(b[d]).getValue(a))});return c?this.expre.getValue(a):null===this.next?null:this.next.getValue(a)},a.NODE=p,a.Node={},a.Node.callNode=c,a.Node.objectNode=d,a.Node.numberNode=e,a.Node.booleanNode=h,a.Node.literalNode=i,a.Node.defineNode=j,a.Node.lambdaNode=g,a.Node.expressionNode=f,a.Node.nativeFunction=b,a.Node.ifConditionNode=k,a.Node.consNode=m,a.Node.listNode=n,a.Node.patternNode=o}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./pattern",[],function(a){var b={};b.unit=function c(a){if(null===a)this.type=null,this.value=null;else if("function"==typeof a)this.type=a,this.value=null;else{if(void 0===a)return new b.any;this.type=a.constructor,this.value=a}if(a instanceof Array){var d=[];a.forEach(function(a){d.push(new c(a))}),this.array=d}},b.any=function(){},b.any.prototype.expect=function(a){return!0},b.unit.prototype.expect=function(a){if(null===a)return null===this.value;if(null===this.value)return a.constructor===this.type;if(void 0!==this.array){if(0===this.array.length&&0===a.length)return!0;if(this.array.length>a.length)return!1;for(var b=0,c=this.array.length;c>b;b++)if(this.array[b].expect(a[b])===!1)return!1;return!0}return this.value===a&&this.type===a.constructor},b.PatternMatching=function(a){var c=[];return a.forEach(function(a){for(var d=[],e=0,f=a.length-1;f>e;e++)d.push(new b.unit(a[e]));d.push(a[a.length-1]),c.push(d)}),function(){var a,b=arguments;return c.some(function(c){for(var d=!0,e=0,f=c.length-1;f>e;e++)c[e].expect(b[e])===!1&&(d=!1);if(d===!0){var g=c[f];a=g.apply(null,b)}return d}),a}},a.Pattern=b}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;if(define("./scope",["./node"],function(a){var b=require("./node").Node,c=function(a){this.root=void 0===a?null:a,this.table={}};c.prototype.add=function(a,b){this.table[a]=b},c.prototype.exist=function(a){return void 0!==this.lookup(a)},c.prototype.lookup=function(a){var b=this.table[a];return void 0===b?null===this.root?b:this.root.lookup(a):b};var d=new c;d.add("print",new b.lambdaNode("$1",new b.nativeFunction(function(a){console.log(a.lookup("$1").getValue(a))}))),d.add("length",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).length}))),d.add("reverse",new b.lambdaNode("$1",new b.nativeFunction(function(a){return a.lookup("$1").getValue(a).concat().reverse()}))),d.add("not",new b.lambdaNode("$1",new b.nativeFunction(function(a){return!a.lookup("$1").getValue(a)}))),a.Scope=c,a.Root=d}),"undefined"==typeof define)var define=function(a,b,c){c(exports)};if("undefined"==typeof require)var require=ll.require;define("./token",[],function(a){function b(a,b){this.type=a,this.value=b}a.Token=b}),"undefined"==typeof define&&(define=function(a,b,c){c(exports)}),"undefined"==typeof require&&(require=ll.require),define("./util",[],function(a){var b={},c="0123456789abcdefABCDEF",d=["if","then","else","let","Number","String","List","Boolean"],e=["Number","String","List","Boolean"],f="+-*/!=|&^~%<>",g="[]{}(),@:\\;$.";b.isDigit=function(a){return a>="0"&&"9">=a},b.isHexDigit=function(a){return c.indexOf(a)>-1},b.isOctalDigit=function(a){return a>="0"&&!1},b.isWhite=function(a){return" "===a||"	"===a||"\n"===a},b.isAlpha=function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a},b.isPunctuator=function(a){return f.indexOf(a)>-1||g.indexOf(a)>-1},b.isSinglePunctuator=function(a){return g.indexOf(a)>-1},b.isLiteralStart=function(a){return"'"===a||'"'===a},b.isBooleanLiteral=function(a){return"true"===a||"false"===a},b.isNullLiteral=function(a){return"null"===a},b.isPunctuatorStart=function(a){return f.index(a)>-1},b.isIdentifierStart=function(a){return this.isAlpha(a)||"_"===a},b.isIdentifierBody=function(a){return this.isIdentifierStart(a)||this.isDigit(a)},b.isKeyword=function(a){return d.indexOf(a)>-1},b.isTypewords=function(a){return e.indexOf(a)>-1},a.Util=b});